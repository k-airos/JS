(()=>{"use strict";const e=class{setColor(e){"object"==typeof e?(e.dataset.value%128==2&&(e.style.backgroundColor="#F44336"),e.dataset.value%128==4&&(e.style.backgroundColor="#7E07A9"),e.dataset.value%128==8&&(e.style.backgroundColor="yellow"),e.dataset.value%128==16&&(e.style.backgroundColor="#67237F"),e.dataset.value%128==32&&(e.style.backgroundColor="#EA69A6"),e.dataset.value%128==64&&(e.style.backgroundColor="#270672"),e.dataset.value%128==0&&(e.style.backgroundColor="#8D6DD7")):(document.querySelector(".game").style.backgroundColor="black",document.querySelector(".header").style.color="white")}},t=class extends e{numberElement=null;spawn(){const e=document.createElement("div"),t=[2,4,8,16];let l=t[Math.floor(Math.random()*t.length)];return e.innerText=l,e.dataset.value=l,e.classList.add("number"),this.numberElement=e,e}moveTo(e,t){const l=document.querySelector(".field");if(null===t.number)e.number.numberElement.style.top=`${t.top}px`,e.number.numberElement.style.left=`${t.left}px`,t.number=e.number,e.number=null;else if(e.number.numberElement.dataset.value===t.number.numberElement.dataset.value){e.number.numberElement.style.top=`${t.top}px`,e.number.numberElement.style.left=`${t.left}px`,e.number.numberElement.style.opacity="0",l.removeChild(e.number.numberElement);const s=2*t.number.numberElement.dataset.value;t.number.numberElement.dataset.value=s,t.number.numberElement.innerText=s,this.setColor(t.number.numberElement),e.number=null}}},l=class extends e{#e;field=document.querySelector(".field");cells=[];#t=!1;directionRoots={UP:[],RIGHT:[],DOWN:[],LEFT:[]};getSize(){return this.#e}setsize(e){e>0&&(this.#e=e)}get playable(){return this.#t}set playable(e){this.#t=e}restart(){this.cells=[],this.directionRoots={UP:[],RIGHT:[],DOWN:[],LEFT:[]},document.querySelector(".game").style.backgroundColor="#AAACA8";let e=document.getElementsByClassName("number"),t=document.getElementsByClassName("cell");for(;t[0];)t[0].parentNode.removeChild(t[0]);for(;e[0];)e[0].parentNode.removeChild(e[0]);this.init()}setDirectionRoots(){for(let e=0;e<this.getSize()**2;e++)e<this.getSize()&&this.directionRoots.UP.push(e),e%this.getSize()==this.getSize()-1&&this.directionRoots.RIGHT.push(e),e>=this.getSize()*(this.getSize()-1)&&this.directionRoots.DOWN.push(e),e%this.getSize()==0&&this.directionRoots.LEFT.push(e)}init(){this.playable=!0,document.createElement("div").classList.add("cell"),this.setDirectionRoots(),localStorage.getItem("best")&&(document.querySelector("#best").innerHTML=localStorage.getItem("best"));for(let e=0;e<this.getSize()**2;e++){let t=document.createElement("div");t.style.width=`calc(100%/${this.getSize()} - 1.5vmin)`,t.style.height=`calc(100%/${this.getSize()} - 1.5vmin)`,t.classList.add("cell"),this.field.append(t),this.cells[e]={element:t,number:null}}let e=document.querySelectorAll(".cell"),t=this.getSize();for(let l=0;l<t**2;l++)this.cells[l].top=e[l].offsetTop,this.cells[l].left=e[l].offsetLeft;this.gridTakePlace()}gridTakePlace(){const e=this.randomEmptyCell();if(!1===e||!1===this.playable)return!1;let l=new t,s=l.spawn();return s.style.top=`${this.cells[e].top}px`,s.style.left=`${this.cells[e].left}px`,s.style.width=`calc(100%/${this.getSize()} - 1.5vmin)`,s.style.height=`calc(100%/${this.getSize()} - 1.5vmin)`,this.setColor(s),this.cells[e].number=l,this.field.append(s),this.score(),!0}score(){let e=document.querySelectorAll(".number"),t=0;e.forEach((e=>{t+=+e.innerText})),document.querySelector("#score").innerText=t,t>200&&this.setColor(t)}randomEmptyCell(){let e=[];for(let t=0;t<this.cells.length;t++)null===this.cells[t].number&&e.push(t);return 0!==e.length&&e[Math.floor(Math.random()*e.length)]}slide(e){if(!this.playable)return!1;const t=this.directionRoots[e];let l;"DOWN"===e&&(l=-this.getSize()),"UP"===e&&(l=this.getSize()),"RIGHT"===e&&(l=-1),"LEFT"===e&&(l=1);for(let e=0;e<this.getSize();e++){const s=t[e];for(let e=1;e<this.getSize();e++){const t=s+e*l,n=this.cells[t];if(null!==n.number){let t=null;for(let r=e-1;r>=0;r--){const e=s+r*l,o=this.cells[e];if(null!==o.number){if(n.number.numberElement.dataset.value===o.number.numberElement.dataset.value){t=o;break}break}t=o}null!==t&&n.number.moveTo(n,t)}}}this.playable=!1,setTimeout((()=>{this.playable=!0,this.gridTakePlace()?this.playable=!0:(this.playable=!1,(!localStorage.getItem("best")||localStorage.getItem("best")<document.querySelector("#score"))&&(localStorage.setItem("best",document.querySelector("#score").innerText),document.querySelector("#best").innerText=localStorage.getItem("best")),alert("GAME OVER!"),this.restart())}),200)}};let s;document.querySelector("input").addEventListener("keydown",(e=>{13===e.keyCode&&(!isNaN(+document.querySelector("input").value)&&+document.querySelector("input").value>0&&+document.querySelector("input").value<15?(document.querySelector(".modal").classList.add("hide"),s=new l,s.setsize(+document.querySelector("input").value),s.init(),document.querySelector("input").remove()):document.querySelector("input").value="Введите корректное значение")})),window.addEventListener("resize",(()=>{if(s){let e=document.querySelectorAll(".cell");for(let t=0;t<s.cells.length;t++)s.cells[t].top=e[t].offsetTop,s.cells[t].left=e[t].offsetLeft,s.cells[t].number&&(s.cells[t].number.numberElement.style.top=`${s.cells[t].top}px`,s.cells[t].number.numberElement.style.left=`${s.cells[t].left}px`)}})),document.addEventListener("keyup",(function(e){let t=null;return 38===e.keyCode?t="UP":39===e.keyCode?t="RIGHT":40===e.keyCode?t="DOWN":37===e.keyCode&&(t="LEFT"),null!==t&&s.slide(t),!1}))})();
//# sourceMappingURL=bundle.js.map